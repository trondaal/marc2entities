<templates xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >
    <entity type="c:Person" templatename="MARC21-100-Person" src="{tokenize(tokenize(base-uri(), '/')[last()], '-')[1]}">
        <anchor tag="100"/>
        <attributes>
            <datafield tag="100">
                <subfield code="a" type="a:nameOfPerson" select="frbrizer:trim(.)"/>
                <subfield code="c" type="a:titleOfThePerson"  select="frbrizer:trim(.)"/>
                 <subfield code="d" type="a:dateAssociatedWithPerson" select="frbrizer:trim(.)"/>
                <subfield code="u" type="a:affiliation" select="frbrizer:trim(.)"/>
                <subfield code="0" type="a:identifierForAgent" select="frbrizer:trim(.)"/>
            </datafield>
        </attributes>
        <key order="1">
            <element>*:datafield/*:subfield[@*:type= 'a:nameOfPerson']</element>
            <element>*:datafield/*:subfield[@*:type= 'a:titleOfPerson']</element>
            <element>*:datafield/*:subfield[@*:type= 'a:dateAssociatedWithPerson']</element>
        </key>
        <relationships>
            <relationship condition="frbrizer:isRelatorCodeToWork(*:subfield[@code = '4'])" type="{frbrizer:relatorcode2rdatype($anchor_field/*:subfield[@code='4'], false())}" itype="{frbrizer:relatorcode2rdatype($anchor_field/*:subfield[@code='4'], true())}">
                <target entity="MARC21-240-Work"/>
                <target entity="MARC21-245-Work"/>
                <target entity="MARC21-246-Work"/>
            </relationship>
        </relationships>
    </entity>
    
    <entity type="c:CorporateBody" templatename="MARC21-110-CorporateBody" src="{tokenize(tokenize(base-uri(), '/')[last()], '-')[1]}">
        <anchor tag="110"/>
        <attributes>
            <datafield tag="110">
                <subfield code="a" type="a:nameOfCorporateBody" select="frbrizer:trim(.)"/>
                <subfield code="b" type="u:hierarchicalSubordinate" select="frbrizer:trim(.)"/>
                <subfield code="c" type="a:placeAssociatedWithCorporateBody" select="frbrizer:trim(.)"/>
                <subfield code="d" type="a:dateAssociatedWithCorporateBody" select="frbrizer:trim(.)"/>
                <subfield code="u" type="a:affiliation" select="frbrizer:trim(.)"/>
            </datafield>
        </attributes>
        <key order="1">
            <element>*:datafield/*:subfield[@*:type = 'a:nameOfCorporateBody']</element>
            <element>*:datafield/*:subfield[@*:type = 'u:hierarchicalSubordinate']</element>
            <element>*:datafield/*:subfield[@*:type = 'a:placeAssociatedWithCorporateBody']</element>
            <element>*:datafield/*:subfield[@*:type = 'a:dateAssociatedWithCorporateBody']</element>
        </key>
        <relationships>
            <relationship condition="frbrizer:isRelatorCodeToWork(*:subfield[@code = '4'])" type="{frbrizer:relatorcode2rdatype($anchor_field/*:subfield[@code='4'], false())}" itype="{frbrizer:relatorcode2rdatype($anchor_field/*:subfield[@code='4'], true())}">
                <target entity="MARC21-240-Work"/>
                <target entity="MARC21-245-Work"/>
                <target entity="MARC21-246-Work"/>
            </relationship>
        </relationships>
    </entity>
    
    
    <entity type="c:CorporateBody" templatename="MARC21-111-CorporateBody" src="{tokenize(tokenize(base-uri(), '/')[last()], '-')[1]}">
        <anchor tag="111"/>
        <attributes>
            <datafield tag="111">
                <subfield code="a" type="a:nameOfCorporateBody" select="frbrizer:trim(.)"/>
                <subfield code="b" type="u:hierarchicalSubordinate" select="frbrizer:trim(.)"/>
                <subfield code="c" type="a:placeAssociatedWithCorporateBody" select="frbrizer:trim(.)"/>
                <subfield code="d" type="a:dateAssociatedWithCorporateBody" select="frbrizer:trim(.)"/>
                <subfield code="u" type="a:affiliation" select="frbrizer:trim(.)"/>
            </datafield>
        </attributes>
        <key order="1">
            <element>*:datafield/*:subfield[@*:type = 'a:nameOfCorporateBody']</element>
            <element>*:datafield/*:subfield[@*:type = 'u:hierarchicalSubordinate']</element>
            <element>*:datafield/*:subfield[@*:type = 'a:placeAssociatedWithCorporateBody']</element>
            <element>*:datafield/*:subfield[@*:type = 'a:dateAssociatedWithCorporateBody']</element>
        </key>
        <relationships>
            <relationship condition="frbrizer:isRelatorCodeToWork(*:subfield[@code = '4'])" type="{frbrizer:relatorcode2rdatype($anchor_field/*:subfield[@code='4'], false())}" itype="{frbrizer:relatorcode2rdatype($anchor_field/*:subfield[@code='4'], true())}">
                <target entity="MARC21-240-Work"/>
                <target entity="MARC21-245-Work"/>
                <target entity="MARC21-246-Work"/>
            </relationship>
        </relationships>
    </entity>
    
    <entity type="c:Work" templatename="MARC21-130-Work" src="{tokenize(tokenize(base-uri(), '/')[last()], '-')[1]}">
        <anchor tag="130"/>
        <attributes>
            <datafield tag="130">
                <subfield code="a" type="w:titleOfWork"/>
                <subfield code="d" type="w:dateOfWork"/>
                <subfield code="f" type="w:dateOfWork"/>
                <subfield code="g" type="{frbrizer:marc21rdftype(.)}"/>
                <subfield code="k" type="w:formOfWork"/>
                <subfield code="m" type="w:mediumOfPerformance"/>
                <subfield code="n" type="w:numberingOfPart"/>
                <subfield code="o" type="w:otherDistinguishingCharacteristicOfTheWork"/>
                <subfield code="p" type="w:numberingOfPart"/>
                <subfield code="r" type="w:key"/>
            </datafield>
            <datafield tag="380" condition="frbrizer:linked($anchor_field, .)">
                <subfield code="a" type="w:formOfWork"/>
            </datafield>
            <datafield tag="520" condition="frbrizer:linked($anchor_field, .)">
                <subfield code="a" type="{frbrizer:marc21rdftype(.)}"/>
            </datafield>
        </attributes>
        <key order="4">
            <element>*:datafield/*:subfield[@*:type = 'w:titleOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:dateOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:formOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:numberingOfPart']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:mediumOfPerformance']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:key']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:otherDistinguishingCharacteristicOfTheWork']</element>
        </key>
        <relationships/>
    </entity>

    <entity type="c:Work" templatename="MARC21-240-Work" src="{tokenize(tokenize(base-uri(), '/')[last()], '-')[1]}">
        <note>Work identified by title in 240</note>
        <anchor tag="240"/>
        <attributes>
            <datafield tag="240">                
                <subfield code="a" type="w:titleOfWork"/>
                <subfield code="d" type="w:dateOfWork"/>
                <subfield code="f" type="w:dateOfWork"/>
                <subfield code="g" type="{frbrizer:marc21rdftype(.)}"/>
                <subfield code="k" type="w:formOfWork"/>
                <subfield code="m" type="w:mediumOfPerformance"/>
                <subfield code="n" type="w:numberingOfPart"/>
                <subfield code="o" type="w:otherDistinguishingCharacteristicOfTheWork"/>
                <subfield code="p" type="w:numberingOfPart"/>
                <subfield code="r" type="w:key"/>
            </datafield>
            <datafield tag="380" condition="frbrizer:linked($anchor_field, .)">
                <subfield code="a" type="w:formOfWork"/>
            </datafield>
        </attributes>
        <key order="4">
            <element>string-join(frbrizer:sort-relationships(*:relationship[frbrizer:isWorkToActorType(@type)])/@href, '')</element>
            <element>*:datafield/*:subfield[@*:type = 'w:titleOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:dateOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:formOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:numberingOfPart']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:mediumOfPerformance']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:key']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:otherDistinguishingCharacteristicOfTheWork']</element>
        </key>
        <relationships/>
    </entity>
    
    <entity templatename="MARC21-245-Work" type="c:Work" src="{tokenize(tokenize(base-uri(), '/')[last()], '-')[1]}">
        <anchor tag="245" condition="not(exists($record/*:datafield[@tag=('246') and *:subfield[@code='i'  ] = 'Orginaltittel'])) and not(exists($record/*:datafield[@tag=('240', '130')]))"/>
        <attributes>
            <datafield tag="245">
                <subfield code="a" type="w:titleOfWork" select="string-join((frbrizer:trim(.), frbrizer:trim(../*:subfield[@code = 'b'])), ' : ')"/>
                <subfield code="d" type="w:dateOfWork"/>
                <subfield code="f" type="w:dateOfWork"/>
                <subfield code="g" type="{frbrizer:marc21rdftype(.)}"/>
                <subfield code="k" type="w:formOfWork"/>
                <subfield code="m" type="w:mediumOfPerformance"/>
                <subfield code="n" type="w:numberingOfPart"/>
                <subfield code="o" type="w:otherDistinguishingCharacteristicOfTheWork"/>
                <subfield code="p" type="w:numberingOfPart"/>
                <subfield code="r" type="w:key"/>
            </datafield>
            <datafield tag="380">
                <subfield code="a" type="w:formOfWork"/>
            </datafield>
        </attributes>
        <key order="2">
            <element>string-join(frbrizer:sort-relationships(*:relationship[frbrizer:isWorkToActorType(@type)])/@href, '')</element>
            <element>*:datafield/*:subfield[@*:type = 'w:titleOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:dateOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:formOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:numberingOfPart']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:mediumOfPerformance']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:key']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:otherDistinguishingCharacteristicOfTheWork']</element>
        </key>
        <relationships/>
    </entity>
  
    <entity templatename="MARC21-246-Work" type="c:Work" src="{tokenize(tokenize(base-uri(), '/')[last()], '-')[1]}">
        <anchor tag="246" condition="*:subfield[@code='i'] = 'Originaltittel'"/>
        <attributes>
            <datafield tag="246">
                <subfield code="a" type="w:titleOfWork" select="string-join((frbrizer:trim(.), frbrizer:trim(../*:subfield[@code = 'b'])), ' : ')"/>
                <subfield code="d" type="w:dateOfWork"/>
                <subfield code="f" type="w:dateOfWork"/>
                <subfield code="g" type="{frbrizer:marc21rdftype(.)}"/>
                <subfield code="k" type="w:formOfWork"/>
                <subfield code="m" type="w:mediumOfPerformance"/>
                <subfield code="n" type="w:numberingOfPart"/>
                <subfield code="o" type="w:otherDistinguishingCharacteristicOfTheWork"/>
                <subfield code="p" type="w:numberingOfPart"/>
                <subfield code="r" type="w:key"/>
            </datafield>
            <datafield tag="380">
                <subfield code="a" type="w:formOfWork"/>
            </datafield>
        </attributes>
        <key order="2">
            <element>string-join(frbrizer:sort-relationships(*:relationship[frbrizer:isWorkToActorType(@type)])/@href, '')</element>
            <element>*:datafield/*:subfield[@*:type = 'w:titleOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:dateOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:formOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:numberingOfPart']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:mediumOfPerformance']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:key']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:otherDistinguishingCharacteristicOfTheWork']</element>
        </key>
        <relationships/>
    </entity>
    
    <entity type="c:Person" templatename="MARC21-600-Person" src="{tokenize(tokenize(base-uri(), '/')[last()], '-')[1]}">
        <anchor tag="600"/>
        <attributes>
            <datafield tag="600">
                <subfield code="a" type="a:nameOfPerson" select="frbrizer:trim(.)"/>
                <subfield code="c" type="a:titleOfThePerson" select="frbrizer:trim(.)"/>
                <subfield code="d" type="a:dateAssociatedWithPerson" select="frbrizer:trim(.)"/>
                <subfield code="u" type="a:affiliation" select="frbrizer:trim(.)"/>
            </datafield>
        </attributes>
        <key order="1">
            <element>*:datafield/*:subfield[@*:type= 'a:nameOfPerson']</element>
            <element>*:datafield/*:subfield[@*:type= 'a:titleOfPerson']</element>
            <element>*:datafield/*:subfield[@*:type= 'a:dateAssociatedWithPerson']</element>
        </key>
        <relationships>
            <relationship condition="not(exists(*:subfield[@code= 't']))" type="frsad:P2002" itype="frsad:P2001">
                <target entity="MARC21-130-Work" condition="(frbrizer:linked($this_field, $target_field))"/>
                <target entity="MARC21-240-Work" condition="(frbrizer:linked($this_field, $target_field))"/>
                <target entity="MARC21-245-Work" condition="(frbrizer:linked($this_field, $target_field))"/>
                <target entity="MARC21-246-Work" condition="(frbrizer:linked($this_field, $target_field))"/>
            </relationship>
            <relationship type="{frbrizer:relatorcode2rdatype($anchor_field/*:subfield[@code='4'], false())}" itype="{frbrizer:relatorcode2rdatype($anchor_field/*:subfield[@code='4'], true())}">
                <target entity="MARC21-600-Work" same-field="true"/>
            </relationship>
        </relationships>
    </entity>
    
    <entity type="c:Work" templatename="MARC21-600-Work" src="{tokenize(tokenize(base-uri(), '/')[last()], '-')[1]}">
        <anchor tag="600">
            <code code="t"/>
        </anchor>
        <attributes>
            <datafield tag="600">
                <subfield code="t" type="w:titleOfWork"/>
                <subfield code="d" type="w:dateOfWork"/>
                <subfield code="f" type="w:dateOfWork"/>
                <subfield code="g" type="{frbrizer:marc21rdftype(.)}"/>
                <subfield code="k" type="w:formOfWork"/>
                <subfield code="m" type="w:mediumOfPerformance"/>
                <subfield code="n" type="w:numberingOfPart"/>
                <subfield code="o" type="w:otherDistinguishingCharacteristicOfTheWork"/>
                <subfield code="p" type="w:numberingOfPart"/>
                <subfield code="r" type="w:key"/>
            </datafield>
        </attributes>
        <key order="3">
            <element>string-join(frbrizer:sort-relationships(*:relationship[frbrizer:isWorkToActorType(@type)])/@href, '')</element>
            <element>*:datafield/*:subfield[@*:type = 'w:titleOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:dateOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:formOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:numberingOfPart']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:mediumOfPerformance']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:key']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:otherDistinguishingCharacteristicOfTheWork']</element>
        </key>
        <relationships>
            <relationship type="frsad:P2002" itype="frsad:P2001">
                <target entity="MARC21-130-Work" condition="(frbrizer:linked($this_field, $target_field))"/>
                <target entity="MARC21-240-Work" condition="(frbrizer:linked($this_field, $target_field))"/>
                <target entity="MARC21-245-Work" condition="(frbrizer:linked($this_field, $target_field))"/>
                <target entity="MARC21-246-Work" condition="(frbrizer:linked($this_field, $target_field))"/>
            </relationship>
        </relationships>
    </entity>
    
    <entity type="c:Person" templatename="MARC21-610-CorporateBody" src="{tokenize(tokenize(base-uri(), '/')[last()], '-')[1]}">
        <anchor tag="610"/>
        <attributes>
            <datafield tag="610">
                <subfield code="a" type="a:nameOfCorporateBody" select="frbrizer:trim(.)"/>
                <subfield code="b" type="u:hierarchicalSubordinate" select="frbrizer:trim(.)"/>
                <subfield code="c" type="a:placeAssociatedWithCorporateBody"/>
                <subfield code="d" type="a:dateAssociatedWithCorporateBody" select="frbrizer:trim(.)"/>
                <subfield code="u" type="a:affiliation"/>
            </datafield>
        </attributes>
        <key order="1">
            <element>*:datafield/*:subfield[@*:type = 'a:nameOfCorporateBody']</element>
            <element>*:datafield/*:subfield[@*:type = 'u:hierarchicalSubordinate']</element>
            <element>*:datafield/*:subfield[@*:type = 'a:placeAssociatedWithCorporateBody']</element>
            <element>*:datafield/*:subfield[@*:type = 'a:dateAssociatedWithCorporateBody']</element>
        </key>
        <relationships>
            <relationship condition="not(exists(*:subfield[@code= 't']))" type="frsad:P2002" itype="frsad:P2001">
                <target entity="MARC21-130-Work" condition="(frbrizer:linked($this_field, $target_field))"/>
                <target entity="MARC21-240-Work" condition="(frbrizer:linked($this_field, $target_field))"/>
                <target entity="MARC21-245-Work" condition="(frbrizer:linked($this_field, $target_field))"/>
                <target entity="MARC21-246-Work" condition="(frbrizer:linked($this_field, $target_field))"/>
            </relationship>
            <relationship type="{frbrizer:relatorcode2rdatype($anchor_field/*:subfield[@code='4'], false())}" itype="{frbrizer:relatorcode2rdatype($anchor_field/*:subfield[@code='4'], true())}">
                <target entity="MARC21-610-Work" same-field="true"/>
                <note>no condition needed because the work is only created if there is a title</note>
            </relationship>
        </relationships>
    </entity>
    
    <entity type="c:Work" templatename="MARC21-610-Work" src="{tokenize(tokenize(base-uri(), '/')[last()], '-')[1]}">
        <anchor tag="610">
            <code code="t"/>
        </anchor>
        <attributes>
            <datafield tag="610">
                <subfield code="a" type="w:titleOfWork"/>
                <subfield code="d" type="w:dateOfWork"/>
                <subfield code="f" type="w:dateOfWork"/>
                <subfield code="g" type="{frbrizer:marc21rdftype(.)}"/>
                <subfield code="k" type="w:formOfWork"/>
                <subfield code="m" type="w:mediumOfPerformance"/>
                <subfield code="n" type="w:numberingOfPart"/>
                <subfield code="o" type="w:otherDistinguishingCharacteristicOfTheWork"/>
                <subfield code="p" type="w:numberingOfPart"/>
                <subfield code="r" type="w:key"/>
            </datafield>
        </attributes>
        <key order="3">
            <element>string-join(frbrizer:sort-relationships(*:relationship[frbrizer:isWorkToActorType(@type)])/@href, '')</element>
            <element>*:datafield/*:subfield[@*:type = 'w:titleOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:dateOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:formOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:numberingOfPart']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:mediumOfPerformance']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:key']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:otherDistinguishingCharacteristicOfTheWork']</element>
        </key>
        <relationships>
            <relationship type="frsad:P2002" itype="frsad:P2001">
                <target entity="MARC21-130-Work" condition="(frbrizer:linked($this_field, $target_field))"/>
                <target entity="MARC21-240-Work" condition="(frbrizer:linked($this_field, $target_field))"/>
                <target entity="MARC21-245-Work" condition="(frbrizer:linked($this_field, $target_field))"/>
                <target entity="MARC21-246-Work" condition="(frbrizer:linked($this_field, $target_field))"/>
            </relationship>
        </relationships>
    </entity>
    
    <entity type="c:Person" templatename="MARC21-611-CorporateBody" src="{tokenize(tokenize(base-uri(), '/')[last()], '-')[1]}">
        <anchor tag="611"/>
        <attributes>
            <datafield tag="611">
                <subfield code="a" type="a:nameOfCorporateBody" select="frbrizer:trim(.)"/>
                <subfield code="b" type="u:hierarchicalSubordinate" select="frbrizer:trim(.)"/>
                <subfield code="c" type="a:placeAssociatedWithCorporateBody"  select="frbrizer:trim(.)"/>
                <subfield code="d" type="a:dateAssociatedWithCorporateBody" select="frbrizer:trim(.)"/>
                <subfield code="u" type="a:affiliation" select="frbrizer:trim(.)"/>
            </datafield>
        </attributes>
        <key order="1">
            <element>*:datafield/*:subfield[@*:type = 'a:nameOfCorporateBody']</element>
            <element>*:datafield/*:subfield[@*:type = 'u:hierarchicalSubordinate']</element>
            <element>*:datafield/*:subfield[@*:type = 'a:placeAssociatedWithCorporateBody']</element>
            <element>*:datafield/*:subfield[@*:type = 'a:dateAssociatedWithCorporateBody']</element>
        </key>
        <relationships>
            <relationship condition="not(exists(*:subfield[@code= 't']))" type="frsad:P2002" itype="frsad:P2001">
                <target entity="MARC21-130-Work" condition="(frbrizer:linked($this_field, $target_field))"/>
                <target entity="MARC21-240-Work" condition="(frbrizer:linked($this_field, $target_field))"/>
                <target entity="MARC21-245-Work" condition="(frbrizer:linked($this_field, $target_field))"/>
                <target entity="MARC21-246-Work" condition="(frbrizer:linked($this_field, $target_field))"/>
            </relationship>
            <relationship type="{frbrizer:relatorcode2rdatype($anchor_field/*:subfield[@code='4'], false())}" itype="{frbrizer:relatorcode2rdatype($anchor_field/*:subfield[@code='4'], true())}">
                <target entity="MARC21-611-Work" same-field="true"/>
                <note>no condition needed because the work is only created if there is a title</note>
            </relationship>
        </relationships>
    </entity>
    
    <entity type="c:Work" templatename="MARC21-611-Work" src="{tokenize(tokenize(base-uri(), '/')[last()], '-')[1]}">
        <anchor tag="611">
            <code code="t"/>
        </anchor>
        <attributes>
            <datafield tag="611">
                <subfield code="a" type="w:titleOfWork"/>
                <subfield code="d" type="w:dateOfWork"/>
                <subfield code="f" type="w:dateOfWork"/>
                <subfield code="g" type="{frbrizer:marc21rdftype(.)}"/>
                <subfield code="k" type="w:formOfWork"/>
                <subfield code="m" type="w:mediumOfPerformance"/>
                <subfield code="n" type="w:numberingOfPart"/>
                <subfield code="o" type="w:otherDistinguishingCharacteristicOfTheWork"/>
                <subfield code="p" type="w:numberingOfPart"/>
                <subfield code="r" type="w:key"/>
            </datafield>
        </attributes>
        <key order="3">
            <element>string-join(frbrizer:sort-relationships(*:relationship[frbrizer:isWorkToActorType(@type)])/@href, '')</element>
            <element>*:datafield/*:subfield[@*:type = 'w:titleOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:dateOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:formOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:numberingOfPart']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:mediumOfPerformance']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:key']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:otherDistinguishingCharacteristicOfTheWork']</element>
        </key>
        <relationships>
            <relationship type="frsad:P2002" itype="frsad:P2001">
                <target entity="MARC21-130-Work" condition="(frbrizer:linked($this_field, $target_field))"/>
                <target entity="MARC21-240-Work" condition="(frbrizer:linked($this_field, $target_field))"/>
                <target entity="MARC21-245-Work" condition="(frbrizer:linked($this_field, $target_field))"/>
                <target entity="MARC21-246-Work" condition="(frbrizer:linked($this_field, $target_field))"/>
            </relationship>
        </relationships>
    </entity>
    
    <entity type="c:Work" templatename="MARC21-630-Work" src="{tokenize(tokenize(base-uri(), '/')[last()], '-')[1]}">
        <anchor tag="630"/>
        <attributes>
            <datafield tag="630">
                <subfield code="a" type="w:titleOfWork"/>
                <subfield code="d" type="w:dateOfWork"/>
                <subfield code="f" type="w:dateOfWork"/>
                <subfield code="g" type="{frbrizer:marc21rdftype(.)}"/>
                <subfield code="k" type="w:formOfWork"/>
                <subfield code="m" type="w:mediumOfPerformance"/>
                <subfield code="n" type="w:numberingOfPart"/>
                <subfield code="o" type="w:otherDistinguishingCharacteristicOfTheWork"/>
                <subfield code="p" type="w:numberingOfPart"/>
                <subfield code="r" type="w:key"/>
            </datafield>
        </attributes>
        <key order="4">
            <element>*:datafield/*:subfield[@*:type = 'w:titleOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:dateOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:formOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:numberingOfPart']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:mediumOfPerformance']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:key']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:otherDistinguishingCharacteristicOfTheWork']</element>
        </key>
        <relationships>
            <relationship type="frsad:P2002" itype="frsad:P2001">
                <target entity="MARC21-130-Work" condition="(frbrizer:linked($this_field, $target_field))"/>
                <target entity="MARC21-240-Work" condition="(frbrizer:linked($this_field, $target_field))"/>
                <target entity="MARC21-245-Work" condition="(frbrizer:linked($this_field, $target_field))"/>
                <target entity="MARC21-246-Work" condition="(frbrizer:linked($this_field, $target_field))"/>
            </relationship>
        </relationships>
    </entity>
    <entity type="c:Person" templatename="MARC21-700-Person" src="{tokenize(tokenize(base-uri(), '/')[last()], '-')[1]}">
        <note>Person identified in 700 - added entry</note>
        <anchor tag="700"/>
        <attributes>
            <datafield tag="700">
                <subfield code="a" type="a:nameOfPerson" select="frbrizer:trim(.)"/>
                <subfield code="c" type="a:titleOfThePerson"  select="frbrizer:trim(.)"/>
                <subfield code="d" type="a:dateAssociatedWithPerson" select="frbrizer:trim(.)"/>
                <subfield code="u" type="a:affiliation" select="frbrizer:trim(.)"/>
            </datafield>
        </attributes>
        <key order="1">
            <element>*:datafield/*:subfield[@*:type= 'a:nameOfPerson']</element>
            <element>*:datafield/*:subfield[@*:type= 'a:titleOfPerson']</element>
            <element>*:datafield/*:subfield[@*:type= 'a:dateAssociatedWithPerson']</element>
        </key>
        <relationships>
            <relationship type="{frbrizer:relatorcode2rdatype($anchor_field/*:subfield[@code='4'], false())}" itype="{frbrizer:relatorcode2rdatype($anchor_field/*:subfield[@code='4'], true())}">
                <target entity="MARC21-700-Work" same-field="true"/>
                <note>no condition needed because the work in 700 is only created if there is a title</note>
            </relationship>
        </relationships>
    </entity>
    
    <entity type="c:Work" templatename="MARC21-700-Work" subtype="{$anchor_field/*:subfield[@code='k']}" src="{tokenize(tokenize(base-uri(), '/')[last()], '-')[1]}">
        <note>Work identified in 700 - added entry</note>
        <anchor tag="700">
            <code code="t"/>
        </anchor>
        <attributes>
            <datafield tag="700">
                <subfield code="t" type="w:titleOfWork"/>
                <subfield code="d" type="w:dateOfWork"/>
                <subfield code="f" type="w:dateOfWork"/>
                <subfield code="g" type="{frbrizer:marc21rdftype(.)}"/>
                <subfield code="k" type="w:formOfWork"/>
                <subfield code="m" type="w:mediumOfPerformance"/>
                <subfield code="n" type="w:numberingOfPart"/>
                <subfield code="o" type="w:otherDistinguishingCharacteristicOfTheWork"/>
                <subfield code="p" type="w:numberingOfPart"/>
                <subfield code="r" type="w:key"/>
            </datafield>
        </attributes>
        <key order="3">
            <element>string-join(frbrizer:sort-relationships(*:relationship[frbrizer:isWorkToActorType(@type)])/@href, '')</element>
            <element>*:datafield/*:subfield[@*:type = 'w:titleOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:dateOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:formOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:numberingOfPart']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:mediumOfPerformance']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:key']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:otherDistinguishingCharacteristicOfTheWork']</element>
        </key>
        <relationships/>      
    </entity>
    
    <entity type="c:Person" templatename="MARC21-710-CorporateBody" src="{tokenize(tokenize(base-uri(), '/')[last()], '-')[1]}">
        <anchor tag="710"/>
        <attributes>
            <datafield tag="710">
                <subfield code="a" type="a:nameOfCorporateBody" select="frbrizer:trim(.)"/>
                <subfield code="b" type="u:hierarchicalSubordinate" select="frbrizer:trim(.)"/>
                <subfield code="c" type="a:placeAssociatedWithCorporateBody" select="frbrizer:trim(.)"/>
                <subfield code="d" type="a:dateAssociatedWithCorporateBody" select="frbrizer:trim(.)"/>
                <subfield code="u" type="a:affiliation" select="frbrizer:trim(.)"/>
            </datafield>
        </attributes>
        <key order="1">
            <element>*:datafield/*:subfield[@*:type = 'a:nameOfCorporateBody']</element>
            <element>*:datafield/*:subfield[@*:type = 'u:hierarchicalSubordinate']</element>
            <element>*:datafield/*:subfield[@*:type = 'a:placeAssociatedWithCorporateBody']</element>
            <element>*:datafield/*:subfield[@*:type = 'a:dateAssociatedWithCorporateBody']</element>
        </key>
        <relationships>
            <relationship type="{frbrizer:relatorcode2rdatype($anchor_field/*:subfield[@code='4'], false())}" itype="{frbrizer:relatorcode2rdatype($anchor_field/*:subfield[@code='4'], true())}">
                <target entity="MARC21-710-Work" same-field="true"/>
            </relationship>
        </relationships>
    </entity>
    
    <entity type="c:Work" templatename="MARC21-710-Work" src="{tokenize(tokenize(base-uri(), '/')[last()], '-')[1]}">
        <anchor tag="710">
            <code code="t"/>
        </anchor>
        <attributes>
            <datafield tag="710">
                <subfield code="t" type="w:titleOfWork"/>
                <subfield code="d" type="w:dateOfWork"/>
                <subfield code="f" type="w:dateOfWork"/>
                <subfield code="g" type="{frbrizer:marc21rdftype(.)}"/>
                <subfield code="k" type="w:formOfWork"/>
                <subfield code="m" type="w:mediumOfPerformance"/>
                <subfield code="n" type="w:numberingOfPart"/>
                <subfield code="o" type="w:otherDistinguishingCharacteristicOfTheWork"/>
                <subfield code="p" type="w:numberingOfPart"/>
                <subfield code="r" type="w:key"/>
            </datafield>
        </attributes>
        <key order="3">
            <element>string-join(frbrizer:sort-relationships(*:relationship[frbrizer:isWorkToActorType(@type)])/@href, '')</element>
            <element>*:datafield/*:subfield[@*:type = 'w:titleOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:dateOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:formOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:numberingOfPart']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:mediumOfPerformance']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:key']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:otherDistinguishingCharacteristicOfTheWork']</element>
        </key>
        <relationships/>
    </entity>
    
    <entity type="c:Person" templatename="MARC21-711-CorporateBody" src="{tokenize(tokenize(base-uri(), '/')[last()], '-')[1]}">
        <anchor tag="711"/>
        <attributes>
            <datafield tag="711">
                <subfield code="a" type="a:nameOfCorporateBody" select="frbrizer:trim(.)"/>
                <subfield code="b" type="u:hierarchicalSubordinate" select="frbrizer:trim(.)"/>
                <subfield code="c" type="a:placeAssociatedWithCorporateBody" select="frbrizer:trim(.)"/>
                <subfield code="d" type="a:dateAssociatedWithCorporateBody" select="frbrizer:trim(.)"/>
                <subfield code="u" type="a:affiliation" select="frbrizer:trim(.)"/>
            </datafield>
        </attributes>
        <key order="1">
            <element>*:datafield/*:subfield[@*:type = 'a:nameOfCorporateBody']</element>
            <element>*:datafield/*:subfield[@*:type = 'u:hierarchicalSubordinate']</element>
            <element>*:datafield/*:subfield[@*:type = 'a:placeAssociatedWithCorporateBody']</element>
            <element>*:datafield/*:subfield[@*:type = 'a:dateAssociatedWithCorporateBody']</element>
        </key>
        <relationships>
            <relationship type="{frbrizer:relatorcode2rdatype($anchor_field/*:subfield[@code='4'], false())}" itype="{frbrizer:relatorcode2rdatype($anchor_field/*:subfield[@code='4'], true())}">
                <target entity="MARC21-711-Work" same-field="true"/>
            </relationship>
        </relationships>
    </entity>
    
    <entity type="c:Work" templatename="MARC21-711-Work" src="{tokenize(tokenize(base-uri(), '/')[last()], '-')[1]}">
        <anchor tag="711">
            <code code="t"/>
        </anchor>
        <attributes>
            <datafield tag="711">
                <subfield code="t" type="w:titleOfWork"/>
                <subfield code="d" type="w:dateOfWork"/>
                <subfield code="f" type="w:dateOfWork"/>
                <subfield code="g" type="{frbrizer:marc21rdftype(.)}"/>
                <subfield code="k" type="w:formOfWork"/>
                <subfield code="m" type="w:mediumOfPerformance"/>
                <subfield code="n" type="w:numberingOfPart"/>
                <subfield code="o" type="w:otherDistinguishingCharacteristicOfTheWork"/>
                <subfield code="p" type="w:numberingOfPart"/>
                <subfield code="r" type="w:key"/>
            </datafield>
        </attributes>
        <key order="3">
            <element>string-join(frbrizer:sort-relationships(*:relationship[frbrizer:isWorkToActorType(@type)])/@href, '')</element>
            <element>*:datafield/*:subfield[@*:type = 'w:titleOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:dateOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:formOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:numberingOfPart']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:mediumOfPerformance']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:key']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:otherDistinguishingCharacteristicOfTheWork']</element>
        </key>
        <relationships/>
    </entity>
    
    <entity type="c:Work" templatename="MARC21-730-Work" subtype="{if ($anchor_field/*:subfield[@code='k']) then $anchor_field/*:subfield[@code='k'] else $record/*:datafield[@tag='380']/*:subfield[@code = 'a']}" src="{tokenize(tokenize(base-uri(), '/')[last()], '-')[1]}">
        <note>Work identified in 730 </note>
        <anchor tag="730"/>
        <attributes>
            <datafield tag="730"><!-- joining title  $a and name of part $p  to one string -->
                <subfield code="a" type="w:titleOfWork"/>
                <subfield code="d" type="w:dateOfWork"/>
                <subfield code="f" type="w:dateOfWork"/>
                <subfield code="g" type="{frbrizer:marc21rdftype(.)}"/>
                <subfield code="k" type="w:formOfWork"/>
                <subfield code="m" type="w:mediumOfPerformance"/>
                <subfield code="n" type="w:numberingOfPart"/>
                <subfield code="o" type="w:otherDistinguishingCharacteristicOfTheWork"/>
                <subfield code="p" type="w:numberingOfPart"/>
                <subfield code="r" type="w:key"/>
            </datafield>
            <datafield tag="380" condition="frbrizer:linked($anchor_field, .)">
                <subfield code="a" type="w:formOfWork"/>
            </datafield>
        </attributes>
        <key order="4">
            <element>string-join(frbrizer:sort-relationships(*:relationship[frbrizer:isWorkToActorType(@type)])/@href, '')</element>
            <element>*:datafield/*:subfield[@*:type = 'w:titleOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:dateOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:formOfWork']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:numberingOfPart']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:mediumOfPerformance']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:key']</element>
            <element>*:datafield/*:subfield[@*:type = 'w:otherDistinguishingCharacteristicOfTheWork']</element>
        </key>
        <relationships/>
    </entity>

    <stylesheet xmlns:frbrizer="http://idi.ntnu.no/frbrizer/" xmlns:xs="http://www.w3.org/2001/XMLSchema" version="2.0"><!-- This file is for user-defined functions -->
        
        <xsl:function name="frbrizer:marc21rdftype" as="xs:string" xmlns:frbrizer="http://idi.ntnu.no/frbrizer/">
            <xsl:param name="node" as="element()"/>
            <xsl:variable name="prefix" select="'marcrdf'"/>
            <xsl:variable name="tag" select="$node/ancestor-or-self::node()[@tag]/@tag"/>
            <xsl:variable name="code" select="$node/ancestor-or-self::node()[@code]/@code"/>
            <xsl:variable name="ind1" select="if (matches($node/ancestor-or-self::node()[@tag]/@ind1, '[a-zA-Z0-9]')) then $node/ancestor-or-self::node()[@tag]/@ind1 else '_'"/>
            <xsl:variable name="ind2" select="if (matches($node/ancestor-or-self::node()[@tag]/@ind2, '[a-zA-Z0-9]')) then $node/ancestor-or-self::node()[@tag]/@ind2 else '_'"/>
            <xsl:value-of select="if (local-name($node) eq 'controlfield') then concat($prefix, ':M', $tag) else concat($prefix, ':M', $tag, $ind1, $ind2, $code)"/>
        </xsl:function>
        
        <xsl:function name="frbrizer:linked" as="xs:boolean"><!-- returns true if the two fields have the same marc 21 link ($8), or if there is no linking subfields in the target (second parameter) -->
            <xsl:param name="anchor" as="element()"/>
            <xsl:param name="target" as="element()"/><!-- <xsl:value-of select="(some $x in $anchor/subfield[@code='8'] satisfies $x = $target/subfield[@code='8']) or (not(exists($anchor/subfield[@code='8'])) and not(exists($target/subfield[@code='8'])))"/>  -->
            <xsl:value-of select="(some $x in $anchor/*:subfield[@code = '8'] satisfies $x = $target/*:subfield[@code = '8']) or (not(exists($target/*:subfield[@code = '8'])))"/>
        </xsl:function>
        <xsl:function name="frbrizer:trim" as="xs:string*">
            <xsl:param name="value" as="element()*"/>
            <xsl:for-each select="$value">
                <xsl:value-of select="replace(., '[ \.,/:]+$', '')"/>
            </xsl:for-each>
        </xsl:function>
        <xsl:function name="frbrizer:idprefix">
            <xsl:param name="value"/>
            <xsl:choose>
                <xsl:when test="$value = '0'">
                    <xsl:value-of select="'isrc'"/>
                </xsl:when>
                <xsl:when test="$value = '1'">
                    <xsl:value-of select="'upc'"/>
                </xsl:when>
                <xsl:when test="$value = '2'">
                    <xsl:value-of select="'ismn'"/>
                </xsl:when>
                <xsl:when test="$value = '3'">
                    <xsl:value-of select="'ian'"/>
                </xsl:when>
                <xsl:when test="$value = '4'">
                    <xsl:value-of select="'sici'"/>
                </xsl:when>
                <xsl:otherwise>
                    <xsl:value-of select="'unknown'"/>
                </xsl:otherwise>
            </xsl:choose>
        </xsl:function>
        
        <xsl:function name="frbrizer:relatorcode2rdatype">
            <xsl:param name="relatorcodes" as="xs:string*"/>
            <xsl:param name="inverse" as="xs:boolean"/><!-- true will return inverse property -->
            <xsl:variable name="relatorcode" select="$relatorcodes[1]"/>
            <xsl:choose><!-- default if empty value for relatorcode-->
                <xsl:when test="empty($relatorcode) and $inverse eq false()">
                    <xsl:value-of select="'a:authorOf'"/>
                </xsl:when>
                <xsl:when test="empty($relatorcode) and $inverse eq true()">
                    <xsl:value-of select="'w:author'"/>
                </xsl:when><!-- Work related relatorcodes aut, drt, act, edt, clb -->
                <xsl:when test="$relatorcode eq 'aut' and $inverse eq false()">
                    <xsl:value-of select="'a:authorOf'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'aut' and $inverse eq true()">
                    <xsl:value-of select="'w:author'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'cmp' and $inverse eq false()">
                    <xsl:value-of select="'a:composerOf'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'cmp' and $inverse eq true()">
                    <xsl:value-of select="'w:composer'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'drt' and $inverse eq false()">
                    <xsl:value-of select="'a:directorOf'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'drt' and $inverse eq true()">
                    <xsl:value-of select="'w:director'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'act' and $inverse eq false()">
                    <xsl:value-of select="'u:actorOf'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'act' and $inverse eq true()">
                    <xsl:value-of select="'u:actor'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'edt' and $inverse eq false()">
                    <xsl:value-of select="'a:compilerOf'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'edt' and $inverse eq true()">
                    <xsl:value-of select="'w:compiler'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'ctb' and $inverse eq false()">
                    <xsl:value-of select="'a:contributorOf'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'ctb' and $inverse eq true()">
                    <xsl:value-of select="'w:contributor'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'aui' and $inverse eq false()">
                    <xsl:value-of select="'a:authorOf'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'aui' and $inverse eq true()">
                    <xsl:value-of select="'w:author'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'ill' and $inverse eq false()">
                    <xsl:value-of select="'a:artistOf'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'ill' and $inverse eq true()">
                    <xsl:value-of select="'w:artist'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'clr' and $inverse eq false()">
                    <xsl:value-of select="'a:artistOf'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'clr' and $inverse eq true()">
                    <xsl:value-of select="'w:artist'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'cmt' and $inverse eq false()">
                    <xsl:value-of select="'a:authorOf'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'cmt' and $inverse eq true()">
                    <xsl:value-of select="'w:author'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'ive' and $inverse eq false()">
                    <xsl:value-of select="'a:intervieweeOf'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'ive' and $inverse eq true()">
                    <xsl:value-of select="'w:interviewee'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'ivr' and $inverse eq false()">
                    <xsl:value-of select="'a:interviewerOf'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'ivr' and $inverse eq true()">
                    <xsl:value-of select="'w:interviewer'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'aus' and $inverse eq false()">
                    <xsl:value-of select="'a:screenwriterOf'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'aus' and $inverse eq true()">
                    <xsl:value-of select="'w:screenwriter'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'lyr' and $inverse eq false()">
                    <xsl:value-of select="'a:lyricistOf'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'lyr' and $inverse eq true()">
                    <xsl:value-of select="'w:lyricist'"/>
                </xsl:when><!-- Expression related relatorcode -->
                <xsl:when test="$relatorcode eq 'abr' and $inverse eq false()">
                    <xsl:value-of select="'a:abridgerOf'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'abr' and $inverse eq true()">
                    <xsl:value-of select="'e:abridger'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'cnd' and $inverse eq false()">
                    <xsl:value-of select="'a:conductorOf'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'cnd' and $inverse eq true()">
                    <xsl:value-of select="'e:conductor'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'nrt' and $inverse eq false()">
                    <xsl:value-of select="'a:narratorOf'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'nrt' and $inverse eq true()">
                    <xsl:value-of select="'e:narrator'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'trl' and $inverse eq false()">
                    <xsl:value-of select="'a:translatorOf'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'trl' and $inverse eq true()">
                    <xsl:value-of select="'e:translator'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'adp' and $inverse eq false()">
                    <xsl:value-of select="'a:adapterOf'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'adp' and $inverse eq true()">
                    <xsl:value-of select="'e:adaptor'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'prf' and $inverse eq false()">
                    <xsl:value-of select="'a:performerOf'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'prf' and $inverse eq true()">
                    <xsl:value-of select="'e:performer'"/>
                </xsl:when><!-- Manifestation -->
                <xsl:when test="$relatorcode eq 'pbd' and $inverse eq false()">
                    <xsl:value-of select="'u:editorOf'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'pbd' and $inverse eq true()">
                    <xsl:value-of select="'u:editor'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'pbl' and $inverse eq false()">
                    <xsl:value-of select="'a:publisherOf'"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'pbl' and $inverse eq true()">
                    <xsl:value-of select="'m:publisher'"/>
                </xsl:when>
                <xsl:otherwise>
                    <xsl:value-of select="'UNTYPED'"/>
                </xsl:otherwise>
            </xsl:choose>
        </xsl:function><!-- Returns true if the relatorcode implies work -->
        <xsl:function name="frbrizer:isRelatorCodeToWork" as="xs:boolean">
            <xsl:param name="relatorcode" as="xs:string*"/>
            <xsl:value-of select="$relatorcode = ('aut', 'cmp', 'drt', 'act', 'edt', 'ctb', 'aui', 'ill', 'clr', 'cmt', 'ive', 'ivr', 'aus', 'lyr') or empty($relatorcode)"/>
        </xsl:function><!-- Returns true if the relatorcode implies relationship -->
        <xsl:function name="frbrizer:isRelatorCodeToExpression" as="xs:boolean">
            <xsl:param name="relatorcode" as="xs:string*"/>
            <xsl:value-of select="$relatorcode = ('abr', 'cnd', 'nrt', 'trl', 'adp', 'prf' )"/>
        </xsl:function><!-- Returns true if the relatorcode implies manifestation -->
        <xsl:function name="frbrizer:isRelatorCodeToManifestation" as="xs:boolean">
            <xsl:param name="relatorcode" as="xs:string*"/>
            <xsl:value-of select="$relatorcode = ('pbd', 'pbl')"/>
        </xsl:function><!-- Used to filter out relationships to include in the identifier -->
        <xsl:function name="frbrizer:isWorkToActorType" as="xs:boolean">
            <xsl:param name="type"/>
            <xsl:value-of select="$type = ( 'w:creator', 'w:author', 'w:composer', 'w:director', 'u:actor', 'w:compiler', 'w:contributor', 'w:artist', 'w:artist', 'w:interviewee', 'w:interviewer',  'w:screenwriter', 'w:lyricist')"/>
        </xsl:function>
        <xsl:function name="frbrizer:isExpressionToActorType" as="xs:boolean">
            <xsl:param name="type"/>
            <xsl:value-of select="$type = ('e:abridger', 'e:conductor', 'e:narrator', 'e:translator', 'e:adaptor', 'e:performer', 'e:contributor', 'e:narrator', 'e:actor')"/>
        </xsl:function>
        <xsl:function name="frbrizer:isAugmentation" as="xs:boolean">
            <xsl:param name="relatorcode" as="xs:string*"/>
            <xsl:value-of select="$relatorcode = ('aui', 'ill', 'cwt')"/>
        </xsl:function>
        <xsl:function name="frbrizer:augmentationTitle" as="xs:string">
            <xsl:param name="relatorcode" as="xs:string*"/>
            <xsl:choose>
                <xsl:when test="$relatorcode eq 'aui'">
                    <xsl:value-of select="'[Introduction] '"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'ill'">
                    <xsl:value-of select="'[Illustrations] '"/>
                </xsl:when>
                <xsl:when test="$relatorcode eq 'cwt'">
                    <xsl:value-of select="'[Comments] '"/>
                </xsl:when>
                <xsl:otherwise>
                    <xsl:value-of select="'[Unknown]'"/>
                </xsl:otherwise>
            </xsl:choose>
        </xsl:function>
        
        
    </stylesheet>
</templates>